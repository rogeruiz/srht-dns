image: archlinux
packages:
  - tfenv
secrets:
  - ea59ef6c-8791-4e72-868c-6f73d1d97f47
environment:
  project: dns
  TFENV_INSTALL_DIR: ~/.tfenv/
tasks:
  - setup: |
      echo "TF_TOKEN_app_terraform_io=$(cat ~/.user-token-tf-gandi-dns)" >> ~/.buildenv
      pushd "${project}"
      sudo tfenv install
      popd
  - init: |
      pushd "${project}"
      terraform init -input=false
      popd
  - plan: |
      echo "now let's do the plan!"